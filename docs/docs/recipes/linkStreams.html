<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<link rel="alternate" type="application/rss+xml" href="/Etl.Net/blog/rss.xml" title="ETL.NET Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/Etl.Net/blog/atom.xml" title="ETL.NET Blog Atom Feed"><title data-react-helmet="true">Combine streams | ETL.NET</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:image" content="https://paillave.github.io//Etl.Net/img/SmallStreams.jpg"><meta data-react-helmet="true" name="twitter:image" content="https://paillave.github.io//Etl.Net/img/SmallStreams.jpg"><meta data-react-helmet="true" property="og:url" content="https://paillave.github.io//Etl.Net/docs/recipes/linkStreams"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Combine streams | ETL.NET"><meta data-react-helmet="true" name="description" content="Combining streams is the essence of SQL. It is very important to have efficient stream combiners."><meta data-react-helmet="true" property="og:description" content="Combining streams is the essence of SQL. It is very important to have efficient stream combiners."><link data-react-helmet="true" rel="shortcut icon" href="/Etl.Net/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://paillave.github.io//Etl.Net/docs/recipes/linkStreams"><link data-react-helmet="true" rel="alternate" href="https://paillave.github.io//Etl.Net/docs/recipes/linkStreams" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://paillave.github.io//Etl.Net/docs/recipes/linkStreams" hreflang="x-default"><link rel="stylesheet" href="/Etl.Net/assets/css/styles.5001f6a5.css">
<link rel="preload" href="/Etl.Net/assets/js/runtime~main.13f34521.js" as="script">
<link rel="preload" href="/Etl.Net/assets/js/main.da99f966.js" as="script">
</head>
<body>
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/Etl.Net/"><img src="/Etl.Net/img/logo.svg" alt="Etl.Net Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/Etl.Net/img/logo.svg" alt="Etl.Net Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">ETL.NET</b></a><a class="navbar__item navbar__link navbar__link--active" href="/Etl.Net/docs/intro">Documentation</a><a class="navbar__item navbar__link" href="/Etl.Net/blog">Blog</a></div><div class="navbar__items navbar__items--right"><div class="navbar__search searchBarContainer_MM2z"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_s5VG searchBarLoadingRing_2jQk"><div></div><div></div><div></div><div></div></div></div><a href="https://github.com/paillave/Etl.Net" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/Etl.Net/docs/intro">Introduction</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Get Started</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Tutorial</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Patterns &amp; Recipes</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/Etl.Net/docs/recipes/dealWithFiles">Deal with files and protocols</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/Etl.Net/docs/recipes/normalize">Normalize a flat structure</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/Etl.Net/docs/recipes/writeInFiles">Create files</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/Etl.Net/docs/recipes/database">Deal with databases</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/Etl.Net/docs/recipes/handleTraces">Handle traces</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/Etl.Net/docs/recipes/consoleApplication">Make a console application</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/Etl.Net/docs/recipes/getManyData">Get many data</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/Etl.Net/docs/recipes/linkStreams">Combine streams</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/Etl.Net/docs/recipes/useExternalData">Inject values in a process</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/Etl.Net/docs/recipes/reduceAndAggregate">Reduce/aggregate and distinct</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/Etl.Net/docs/recipes/changeData">Change/Create in stream data</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/Etl.Net/docs/recipes/changeScope">Restrict rows</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/Etl.Net/docs/recipes/sorting">Sorting</a></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Operators</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Combine streams</h1></header><p>Combining streams is the essence of SQL. It is very important to have efficient stream combiners.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="select"></a>Select<a class="hash-link" href="#select" title="Direct link to heading">#</a></h2><p>Although <code>Select</code> is an operator dedicated to transform the content of the payload, it can also combine the content of payloads of a stream with the content of a single event stream <code>ISingleStream</code>.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cs"><pre tabindex="0" class="prism-code language-cs codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">private static void DefineProcess(ISingleStream&lt;string&gt; contextStream)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    var res = contextStream</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        .CrossApply(&quot;create values from enumeration&quot;, ctx =&gt; Enumerable.Range(1, 100))</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        .Select(&quot;apply single stream content&quot;, contextStream, (l, r) =&gt; $&quot;{l}-{r}&quot;);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    // ...</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="join-and-leftjoin"></a>Join and LeftJoin<a class="hash-link" href="#join-and-leftjoin" title="Direct link to heading">#</a></h2><p>There is no <code>Join</code> operator; just a <code>LeftJoin</code> exists. Like a regular SQL left join, the right value will be null if nothing matches.
Like in SSIS, the left input stream must be properly sorted depending on the left pivot key, and the stream that is looked up must be keyed on depending on the right pivot key. Both keys must have exactly the same signature (name and types).</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cs"><pre tabindex="0" class="prism-code language-cs codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">private static void DefineProcess(ISingleStream&lt;string&gt; contextStream)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    var sortedStream1 = contextStream</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        .CrossApply(&quot;create values from enumeration&quot;, ctx =&gt; Enumerable</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            .Range(1, 100)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            .Select(i =&gt; new { Id = i, OutputId = i % 10, label = $&quot;Label{i}&quot; }))</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        .EnsureSorted(&quot;ensure it is sorted on OutputId&quot;, i =&gt; new { i.OutputId });</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    var streamToLookup = contextStream</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        .CrossApply(&quot;create values from enumeration2&quot;, ctx =&gt; Enumerable</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            .Range(1, 8)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            .Select(i =&gt; new { Id = i, label = $&quot;OtherLabel{i}&quot; }))</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        .EnsureKeyed(&quot;ensure it is keyed on Id&quot;, i =&gt; new { OutputId = i.Id });</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">    var res = sortedStream1.LeftJoin(&quot;join output values&quot;, streamToLookup, (l, r) =&gt; new { FromLeft = l, FromRight = r });</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    // ...</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p><code>LeftJoin</code> is the operator to chose in favor of <code>Lookup</code> is streams are sorted because nothing remains in memory during the process.
It goes without saying that internally, if streams were not sorted, the operator would have to make it itself. But it may happen that these input streams are already sorted, and then, by sorting it again, the operator would lose precious time, and moreover would have to store both streams content in memory before issuing the output. To prevent this, the way to deal with sorts must be done by the developer. Either by actually sorting, either by simply ensuring the stream is sorted.
If input streams are not sorted, it will be a more convenient choice to deal with the <code>Lookup</code> operator.</p></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="lookup"></a>Lookup<a class="hash-link" href="#lookup" title="Direct link to heading">#</a></h2><p><code>Lookup</code> has the same purpose than <code>LeftJoin</code> and behaves in the same way, but does all the underlying mechanism is done under the hood for non sorted streams.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cs"><pre tabindex="0" class="prism-code language-cs codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">private static void DefineProcess(ISingleStream&lt;string&gt; contextStream)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    var stream1 = contextStream</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        .CrossApply(&quot;create values from enumeration&quot;, ctx =&gt; Enumerable</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            .Range(1, 100)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            .Select(i =&gt; new { Id = i, OutputId = i % 10, label = $&quot;Label{i}&quot; }));</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    var streamToLookup = contextStream</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        .CrossApply(&quot;create values from enumeration2&quot;, ctx =&gt; Enumerable</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            .Range(1, 8)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            .Select(i =&gt; new { Id = i, label = $&quot;OtherLabel{i}&quot; }));</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    var res = stream1.Lookup(&quot;join output values&quot;, streamToLookup, l =&gt; l.OutputId, r =&gt; r.Id, (l, r) =&gt; new { FromLeft = l, FromRight = r });</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    // ...</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="unionmerge"></a>Union/Merge<a class="hash-link" href="#unionmerge" title="Direct link to heading">#</a></h2><p>Merging two streams together can be done with the <code>Union</code> operator.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cs"><pre tabindex="0" class="prism-code language-cs codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">private static void DefineProcess(ISingleStream&lt;string&gt; contextStream)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    var stream1 = contextStream</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        .CrossApply(&quot;create values from enumeration&quot;, ctx =&gt; Enumerable</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            .Range(1, 100)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            .Select(i =&gt; new { Id = i, label = $&quot;Label{i}&quot; }));</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    var stream2 = contextStream</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        .CrossApply(&quot;create values from enumeration2&quot;, ctx =&gt; Enumerable</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            .Range(1, 8)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            .Select(i =&gt; new { Id = i, label = $&quot;OtherLabel{i}&quot; }));</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    var res = stream1.Union(&quot;merge with stream 2&quot;, stream2);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    // ...</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="unionall"></a>UnionAll<a class="hash-link" href="#unionall" title="Direct link to heading">#</a></h2><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cs"><pre tabindex="0" class="prism-code language-cs codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">private static void DefineProcess(ISingleStream&lt;string&gt; contextStream)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    var stream1 = contextStream</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        .CrossApply(&quot;create values from enumeration&quot;, ctx =&gt; Enumerable</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            .Range(1, 100)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            .Select(i =&gt; new { Id = i, label = $&quot;Label{i}&quot; }));</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    var stream2 = contextStream</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        .CrossApply(&quot;create values from enumeration2&quot;, ctx =&gt; Enumerable</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            .Range(1, 8)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            .Select(i =&gt; new { Id = i, label = $&quot;OtherLabel{i}&quot; }));</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    var res = stream1.UnionAll(&quot;merge with stream 2&quot;, stream2);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    // ...</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p><code>UnionAll</code> is a concatenation; it is the least performant way to merge two streams. Unlike in SQL, <code>Union</code> is faster than <code>UnionAll</code> because <code>UnionAll</code> of ETL.NET concatenates both streams. So while the first steam to complete, it needs to store every event of the second stream before emitting them once the first stream is completed.</p></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="substract"></a>Substract<a class="hash-link" href="#substract" title="Direct link to heading">#</a></h2><p><code>Substract</code> remove elements from a stream depending on what is in another stream. The criteria is based on the comparison of 2 keys.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cs"><pre tabindex="0" class="prism-code language-cs codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">private static void DefineProcess(ISingleStream&lt;string&gt; contextStream)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    var stream1 = contextStream</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        .CrossApply(&quot;create values from enumeration&quot;, ctx =&gt; Enumerable</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            .Range(1, 100)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            .Select(i =&gt; new Tmp1 { Id = i, Label = $&quot;Label{i}&quot; }));</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    var stream2 = contextStream</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        .CrossApply(&quot;create values from enumeration2&quot;, ctx =&gt; Enumerable</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            .Range(1, 8)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            .Select(i =&gt; new Tmp1 { Id = i, Label = $&quot;OtherLabel{i}&quot; }));</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    // don&#x27;t issue payload from stream1 if the stream2 emits a payload that contains the same `Id`</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    var res = stream1.Substract(&quot;merge with stream 2&quot;, stream2, i =&gt; i.Id, i =&gt; i.Id);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    // ...</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>If both streams are sorted the way is more straight forward:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cs"><pre tabindex="0" class="prism-code language-cs codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">private static void DefineProcess(ISingleStream&lt;string&gt; contextStream)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    var stream1 = contextStream</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        .CrossApply(&quot;create values from enumeration&quot;, ctx =&gt; Enumerable</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            .Range(1, 100)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            .Select(i =&gt; new Tmp1 { Id = i, Label = $&quot;Label{i}&quot; }))</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        .EnsureSorted(&quot;ensure it is sorted on Id&quot;, i =&gt; new { i.Id });</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    var stream2 = contextStream</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        .CrossApply(&quot;create values from enumeration2&quot;, ctx =&gt; Enumerable</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            .Range(1, 8)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            .Select(i =&gt; new Tmp1 { Id = i, Label = $&quot;OtherLabel{i}&quot; }))</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        .EnsureKeyed(&quot;ensure it is keyed on Id2&quot;, i =&gt; new { i.Id });</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    // don&#x27;t issue payload from stream1 if the stream2 emits a payload that contains the same `Id`</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    var res = stream1.Substract(&quot;merge with stream 2&quot;, stream2);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    // ...</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Having sorted streams that are already sorted make the operator <em>much</em> faster. But sorting it before the operator doesn&#x27;t make sense as this sort can be very heavy. It makes sense when retrieving sorted data from the database for example.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="correlate-to-singlemany"></a>Correlate to single/many<a class="hash-link" href="#correlate-to-singlemany" title="Direct link to heading">#</a></h2><p>The whole correlation mechanism is described in the <a href="/Etl.Net/docs/recipes/docs/recipes/normalize">normalization recipe</a>.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://paillave.github.io/Etl.Net/edit/master/website/docs/recipes/9_linkStreams.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/Etl.Net/docs/recipes/getManyData"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Get many data</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/Etl.Net/docs/recipes/useExternalData"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Inject values in a process Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#select" class="table-of-contents__link">Select</a></li><li><a href="#join-and-leftjoin" class="table-of-contents__link">Join and LeftJoin</a></li><li><a href="#lookup" class="table-of-contents__link">Lookup</a></li><li><a href="#unionmerge" class="table-of-contents__link">Union/Merge</a></li><li><a href="#unionall" class="table-of-contents__link">UnionAll</a></li><li><a href="#substract" class="table-of-contents__link">Substract</a></li><li><a href="#correlate-to-singlemany" class="table-of-contents__link">Correlate to single/many</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 Paillave.</div></div></div></footer></div>
<script src="/Etl.Net/assets/js/runtime~main.13f34521.js"></script>
<script src="/Etl.Net/assets/js/main.da99f966.js"></script>
</body>
</html>